# Tandy 1000 TL/2 ROM Disable Project

## Project Status: ⚠️ HARDWARE MODIFICATION REQUIRED

**UPDATE:** After extensive testing and analysis, we determined that **software-only ROM disable is IMPOSSIBLE** on the Tandy 1000 TL/2.

## Critical Finding

The ROM at E000:0000 **cannot be disabled via software**. The ROMCS (ROM Chip Select) signal is generated by hardwired address decode logic in the DRAM/DMA Control IC (U22) and activates automatically whenever the CPU accesses addresses 0xE0000-0xEFFFF. Port FFEA only controls which ROM page is visible, not whether ROM is enabled.

**To free E000 for DOS UMBs requires physical hardware modification.**

See **[HARDWARE_MOD_GUIDE.md](HARDWARE_MOD_GUIDE.md)** for detailed modification instructions.

## Project Overview

This project documents extensive research into disabling the ROM page frame at memory address `E000:0000` on the Tandy 1000 TL/2. The goal was to free this 64KB memory range for DOS Upper Memory Block (UMB) allocation, providing ~60KB additional upper memory for drivers and TSRs.

After thorough investigation including:
- Port FFEA manipulation testing
- BIOS code analysis
- Memory controller documentation review
- Hardware testing on real TL/2

We conclusively determined that software-based ROM disable is not possible due to hardware architecture limitations.

## Research Findings

### What We Discovered

1. **Port FFEA is NOT a ROM enable/disable control**
   - Port FFEA bits 0-3 only select which ROM page (0-7) is visible
   - Setting different patterns does not disable ROM
   - The handwritten note about "bit 4 disables ROM" was incorrect

2. **ROMCS is Hardware Address-Decoded**
   - The DRAM/DMA Control IC (U22) generates ROMCS signal
   - ROMCS activates automatically when CPU addresses 0xE0000-0xEFFFF
   - This is hardwired silicon logic that cannot be changed by software
   - Boolean equation: `ROMCS = (A23-A17 == 0x0E) AND NOT(REFRESH)`

3. **BIOS Cannot Disable ROM**
   - BIOS only writes 0xC8 to Port FFEA (selects page 8, 640K config)
   - No BIOS code exists to disable ROM
   - ROM mapping occurs at hardware level below BIOS

4. **Hardware Modification Required**
   - Only solution: physically disconnect ROMCS signal
   - See HARDWARE_MOD_GUIDE.md for instructions
   - Involves cutting trace or lifting ROM chip pins

### Key Documentation

- **[MEMORY_CONTROLLER_ANALYSIS.md](MEMORY_CONTROLLER_ANALYSIS.md)** - Complete analysis of why software solution is impossible
- **[HARDWARE_MOD_GUIDE.md](HARDWARE_MOD_GUIDE.md)** - Step-by-step hardware modification instructions
- **[BIOS_ANALYSIS.md](BIOS_ANALYSIS.md)** - BIOS code analysis and Port FFEA references
- **[TESTPAT_FINDINGS.md](TESTPAT_FINDINGS.md)** - Hardware test results and Port FFEA behavior
- **[BITS_0_3_THEORY.md](BITS_0_3_THEORY.md)** - Investigation of ROM paging table patterns

## Background

### About the Tandy 1000 TL/2

The Tandy 1000 TL/2 is a 286-based PC-XT clone manufactured by Tandy Corporation. It features:
- Intel 80286 processor
- Built-in ROM drive functionality
- Standard PC-XT architecture compatibility

### The ROM Drive Issue

The Tandy 1000 TL/2 includes a built-in ROM drive feature that occupies memory space at address `E000:0000`. While this feature was useful in its time, modern DOS users often prefer to use this memory range for UMBs (Upper Memory Blocks), which can significantly improve available conventional memory for applications.

## Technical Details

**Memory Address:** `E000:0000 - E000:FFFF` (64KB page frame window)
**ROM Size:** 512KB (organized as 8 pages of 64KB each)
**Control Port:** I/O Port FFEA (hex) - ROM paging control register
**Purpose:** Free up 64KB of upper memory for DOS UMB allocation
**Target System:** Tandy 1000 TL/2 (286 PC-XT clone)

### ROM Paging System

The TL/2 uses a **paging system** where:
- A 64KB window at E000:0000 provides access to the 512KB ROM
- Port FFEA bits 0-4 select which 64KB "page" is visible
- Only one page is visible at E000 at any given time
- The BIOS switches pages to access different parts of ROM
- The system ROM (BIOS code) is separately mapped at F000:C000

## Project Files

### Documentation
- **[NOROM_DRIVER.md](NOROM_DRIVER.md)** - Complete NOROM.SYS installation and usage guide
- **[ANALYSIS.md](ANALYSIS.md)** - ROM structure analysis and implementation approaches
- **[MEMORY_MAP.md](MEMORY_MAP.md)** - Memory layout and Port FFEA register details
- **[PORT_FFEA_TEST.md](PORT_FFEA_TEST.md)** - Hardware testing procedures

### Source Code (`src/`)
- **norom.asm** - Production DOS device driver (NOROM.SYS)
- **testrom.asm** - ROM disable verification test
- **diagnose.asm** - Comprehensive diagnostic tool
- **portread.asm** - Simple Port FFEA test utility
- **BUILD.BAT** - Batch file to build all programs
- **OUT.LOG** - Hardware test results from real TL/2

### ROM Dump
- `8079044.BIN` - Original 512KB ROM dump from Tandy 1000 TL/2 BIOS

### Technical References (`doc/`)
- TL/2 ROM paging documentation
- Memory controller specifications
- Theory of operation

## Solution: Hardware Modification Required ⚠️

After exhaustive testing, we conclusively determined that **no software solution exists** for disabling ROM at E000:0000.

### Why Software Fails

The NOROM.SYS driver and all Port FFEA manipulation attempts failed because:
- **Port FFEA does NOT control ROM enable/disable** - it only selects ROM pages
- **ROMCS is hardware address-decoded** - generated automatically by memory controller
- **No I/O port or BIOS setting can override this** - it's hardwired silicon logic

### Hardware Modification Solution

The **only** way to disable ROM at E000 is to physically disconnect the ROMCS (ROM Chip Select) signal.

**See [HARDWARE_MOD_GUIDE.md](HARDWARE_MOD_GUIDE.md) for detailed instructions on:**
- Cutting ROMCS trace on motherboard
- Lifting ROM chip pins
- Installing toggle switch for reversible control
- Testing and verification procedures

**⚠️ WARNING:** Hardware modification is permanent and risky. Only attempt if you have electronics experience and can accept losing ROM drive functionality.

## Project Milestones

1. ✅ Analyzed original BIOS ROM dump (512KB, Phoenix BIOS v02.00.00)
2. ✅ Understood ROM paging system architecture (8 pages via Port FFEA)
3. ❌ Tested Port FFEA methods - confirmed does NOT disable ROM
4. ✅ Analyzed BIOS code - confirmed no software disable exists
5. ✅ Analyzed memory controller - found ROMCS is hardware address-decoded
6. ✅ Documented hardware modification solution
7. ⏳ **Community testing needed** for hardware modification approach

## Memory Map Reference

Standard PC/XT Upper Memory Layout:
```
A000:0000 - AFFF:FFFF : VGA/EGA Graphics Memory
B000:0000 - BFFF:FFFF : Monochrome/Color Text Memory
C000:0000 - DFFF:FFFF : Adapter ROM/RAM
E000:0000 - EFFF:FFFF : ROM Drive (Target for modification)
F000:0000 - FFFF:FFFF : System BIOS
```

## Implementation Approaches Explored

### Approach 1: Port FFEA Manipulation ❌ FAILED
**Status:** ❌ **DOES NOT WORK** - Port FFEA does not control ROM enable/disable

The handwritten note in the TL/2 technical documentation was **INCORRECT**:
> "Writing 1 to bit 4 disables access to the ROM segment at E0000"

**Why it Failed:**
- Port FFEA only controls ROM page selection (which 64KB page is visible)
- Bit 4 is used for TL/SL system type detection (inverts on readback)
- No Port FFEA pattern disables ROMCS signal
- Hardware testing confirmed E000:0000 always shows ROM data regardless of Port FFEA value

**What Port FFEA Actually Does:**
```assembly
; Port FFEA bits 0-3 select ROM page (0-7)
; Port FFEA bit 4 inverts on TL/2 (system detection)
; Port FFEA bits 5-7 are memory configuration
; NONE of these control ROM enable/disable!
```

### Approach 2: BIOS Code Modification ❌ NOT POSSIBLE
**Status:** ❌ **CANNOT WORK** - BIOS has no control over ROMCS

Analysis of BIOS code revealed:
- BIOS only writes 0xC8 to Port FFEA (selects page 8, 640K config)
- No BIOS code exists to disable ROM
- BIOS cannot override hardware address decoder
- ROM mapping happens below BIOS in hardware stack

**BIOS Port FFEA Writes Found:**
- F000:C4C6 - Writes 0xC8 during POST
- F000:C91B - Writes 0xC8 with loop (page scanning)

**Conclusion:** BIOS modification cannot solve this problem.

### Approach 3: DOS Device Driver ❌ NOT POSSIBLE
**Status:** ❌ **CANNOT WORK** - Software has no control over ROMCS

**Attempts made:**
- norom.asm - Attempts to set Port FFEA bit 4
- testbits.asm - Attempts to set Port FFEA bits 0-3 = 1111
- Various Port FFEA patterns tested

**Why it Failed:**
- No software (DOS driver, BIOS, Port FFEA) can control ROMCS
- ROMCS is generated by hardwired address decode logic
- Software is powerless against hardware architecture

### Approach 4: Hardware Modification ✅ ONLY SOLUTION
**Status:** ✅ **THIS WORKS** - Physically disconnect ROMCS signal

Analysis of memory controller revealed:
- ROMCS is generated by DRAM/DMA Control IC (U22)
- Address decode logic equation:
  ```
  ROMCS = /A23 & /A22 & /A21 & /A20 & A19 & A18 & A17 & /REFRESH
  ```
- Activates automatically for addresses 0xE0000-0xEFFFF
- **Cannot be overridden by any software mechanism**

**Solutions:**
1. **Cut ROMCS# trace** between U22 and ROM chips (permanent)
2. **Lift ROMCS# pins** on ROM chips U54-U57 (reversible)
3. **Install toggle switch** in ROMCS# path (reversible, can switch modes)
4. **GAL-based override** circuit (advanced, fully programmable)

**See [HARDWARE_MOD_GUIDE.md](HARDWARE_MOD_GUIDE.md) for complete instructions.**

## Development Status

**Research Completed:**
- ✅ ROM dump analyzed (512KB, 8 pages, BIOS version 02.00.00)
- ✅ Technical documentation reviewed
- ✅ ROM paging architecture understood
- ✅ Memory controller operation documented
- ✅ Port FFEA control register fully tested
- ✅ BIOS code analyzed and documented
- ✅ Hardware tests on real TL/2 conducted
- ✅ **Conclusively proved software solution is impossible**
- ✅ Hardware modification guide created

**Next Steps:**
1. ⏳ **Community testing of hardware modification**
2. ⏳ Document successful hardware mod results
3. ⏳ Refine hardware mod procedures based on feedback

## Safety Warnings

⚠️ **HARDWARE MODIFICATION REQUIRED**

This project requires physical modification to your Tandy 1000 TL/2 motherboard:

- **Hardware modification is PERMANENT** - cutting traces cannot be easily reversed
- **ROM drive functionality will be LOST** - cannot boot from ROM or use DeskMate
- **Risk of DAMAGING motherboard** if incorrect trace is cut
- **System may FAIL TO BOOT** if modification is done incorrectly
- **Requires electronics experience** - soldering, trace identification, continuity testing

**Before attempting hardware modification:**
- Read [HARDWARE_MOD_GUIDE.md](HARDWARE_MOD_GUIDE.md) completely
- Ensure you have proper tools (multimeter, hobby knife, magnifier)
- Create DOS boot disk for recovery
- Backup ROM dump (already included: 8079044.BIN)
- Accept that ROM drive will be permanently disabled
- Understand you may render your TL/2 unusable

## Contributing

Contributions, suggestions, and issue reports are welcome. Please ensure any modifications are well-documented and tested.

## License

This project involves reverse engineering and modification of vintage computer hardware BIOS. Please respect applicable laws and regulations regarding BIOS modification in your jurisdiction.

## References

- Tandy 1000 TL/2 Technical Reference
- DOS Upper Memory Block (UMB) management
- x86 286 architecture documentation
